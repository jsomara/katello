KT.panel.set_expand_cb(function(){KT.menu.hoverMenu("#panel .third_level:first-child",{top:"75px"})});KT.panel_search_autocomplete=KT.panel_search_autocomplete.concat(["distribution.name:","distribution.version:","network.hostname:","network.ipaddr:","...Any System Fact"]);(function(){var a={create:"new_system"};if(window.env_select!==undefined){env_select.env_changed_callback=function(b){if(env_select.envsys==true){$("#new").attr("data-ajax_url",KT.routes.new_system_path()+"?env_id="+b)}$("#system_environment_id").attr("value",b)};$.extend(a,{extra_params:[{hash_id:"env_id",init_func:function(){var b=$.bbq.getState("env_id");if(b){env_select.set_selected(b)}else{$.bbq.pushState({env_id:env_select.get_selected_env()})}}}]})}KT.panel.list.registerPage("systems",a)}());$(document).ready(function(){KT.panel.set_expand_cb(function(){KT.subs.initialize_edit()});KT.systems_page.registerActions();$("#unsubscribe").live("ajax:complete",function(b,d,a,e){var f=$(".left").find(".active");var c=f.attr("data-ajax_url");c=c.substring(0,c.length-5);KT.panel.list.refresh(f.attr("id"),c)});$("#subscribe").live("ajax:complete",function(b,d,a,e){var f=$(".left").find(".active");var c=f.attr("data-ajax_url");c=c.substring(0,c.length-5);KT.panel.list.refresh(f.attr("id"),c)})});KT.systems_page=(function(){return{env_change:function(a,c){var b=c.attr("data-url");window.location=b},create_system:function(b){var a=b.find('input[type|="submit"]');a.attr("disabled","disabled");b.ajaxSubmit({success:function(c){list.add(c);KT.panel.closePanel($("#panel"));KT.panel.select_item(list.last_child().attr("id"))},error:function(c){a.removeAttr("disabled")}})},registerActions:function(){var a=$(".panel_action[data-id=remove_systems]");KT.panel.actions.registerAction("remove_systems",{url:a.attr("data-url"),method:a.attr("data-method"),success_cb:function(b){$.each(b,function(c,d){list.remove("system_"+d)})}})}}})();KT.subs=function(){var f=function(){var j=$("#unsubscribe");var i=$("#unsub_submit");var n=$("#fake_unsub_submit");var m=$('#unsubscribe input[type="checkbox"]');var l=m.length;var k=0;i.hide();m.each(function(){$(this).change(function(){if($(this).is(":checked")){k++;if(!(i.is(":visible"))){n.fadeOut("fast",function(){i.fadeIn()})}}else{k--;if((i.is(":visible"))&&k==0){i.fadeOut("fast",function(){n.fadeIn()})}}})})},c=function(i){$("#system_environment_id").attr("value",i)},h=function(){g()},g=function(){if(window.env_select!==undefined){$("#path-expanded").hide();env_select.reset_hover();env_select.recalc_scroll()}},a=function(){var j=$("#subscribe");var l=$("#sub_submit");var i=$("#fake_sub_submit");var o=$('#subscribe input[type="checkbox"]');var n=o.length;var m=0;var p;var k;l.hide();o.each(function(){$(this).change(function(){if($(this).is(":checked")){m++;p=$(this).parent().parent().parent().find(".ui-spinner");if(p.length>0){if(p.spinner("value")=="0"){p.spinner("increment")}}else{$(this).parent().parent().parent().find(".ui-nonspinner").val(1);p=$(this).parent().parent().parent().find(".ui-nonspinner-label")[0];if(p){k="1"+p.innerHTML.substr(1);p.innerHTML=k}}if(!(l.is(":visible"))){i.fadeOut("fast",function(){l.fadeIn()})}}else{m--;p=$(this).parent().parent().parent().find(".ui-spinner");if(p.length>0){p.spinner("value",0)}else{$(this).parent().parent().parent().find(".ui-nonspinner").val(0);p=$(this).parent().parent().parent().find(".ui-nonspinner-label")[0];if(p){k="0"+p.innerHTML.substr(1);p.innerHTML=k}}if((l.is(":visible"))&&m==0){l.fadeOut("fast",function(){i.fadeIn()})}}})})},d=function(){setTimeout("$('.ui-spinner').spinner()",1000)},b=function(){var i=$("#autoheal");i.each(function(){$(this).unbind("change");$(this).change(function(){$("#autoheal_form").ajaxSubmit({data:{autoheal:$(this).is(":checked")},dataType:"html",success:function(j){notices.checkNotices()},error:function(j){notices.checkNotices()}})})})},e=function(){$("#matchsystem").unbind("click");$("#matchsystem").change(function(i){$("#matchsystem_form").ajaxSubmit({data:{value:$(this).is(":checked")},dataType:"html",success:function(j){notices.checkNotices();$("#subscriptions > a").click()},error:function(j){notices.checkNotices();$("#subscriptions > a").click()}})})};return{unsubSetup:f,subSetup:a,spinnerSetup:d,save_selected_environment:c,initialize_edit:h,reset_env_select:g,autohealSetup:b,matchsystemSetup:e}}();(function(g,h){var i="ui-state-active",s="ui-state-hover",e="ui-state-disabled",k=g.ui.keyCode,m=k.UP,n=k.DOWN,r=k.RIGHT,f=k.LEFT,j=k.PAGE_UP,p=k.PAGE_DOWN,q=k.HOME,d=k.END,l=g.browser.msie,c=g.browser.mozilla?"DOMMouseScroll":"mousewheel",o=".uispinner",a=[m,n,r,f,j,p,q,d,k.BACKSPACE,k.DELETE,k.TAB],b;g.widget("ui.spinner",{options:{min:null,max:null,allowNull:false,group:"",point:".",prefix:"",suffix:"",places:null,defaultStep:1,largeStep:10,mouseWheel:true,increment:"slow",className:null,showOn:"always",width:16,upIconClass:"ui-icon-triangle-1-n",downIconClass:"ui-icon-triangle-1-s",format:function(w,v){var u=this,x=/(\d+)(\d{3})/;var t;if("free"==v){t=(isNaN(w)?0:Math.abs(w))+""}else{t=((isNaN(w)?0:Math.abs(w)).toFixed(v))+""}for(t=t.replace(".",u.point);x.test(t)&&u.group;t=t.replace(x,"$1"+u.group+"$2")){}return(w<0?"-":"")+u.prefix+t+u.suffix},parse:function(u){var t=this;if(t.group=="."){u=u.replace(".","")}if(t.point!="."){u=u.replace(t.point,".")}return parseFloat(u.replace(/[^0-9\-\.]/g,""))}},_create:function(){var u=this,t=u.element,v=t.attr("type");if(!t.is("input")||((v!="text")&&(v!="number"))){console.error("Invalid target for ui.spinner");return}u._procOptions(true);u._createButtons(t);if(!t.is(":enabled")){u.disable()}},_createButtons:function(D){function C(U){return U=="auto"?0:parseInt(U)}var G=this,x=G.options,v=x.className,L=x.width,y=x.showOn,B=g.support.boxModel,H=D.outerHeight(),P=G.oMargin=C(D.css("margin-right"));D.css({textAlign:"right"});if(y!="never"){wrapper=G.wrapper=D.css({width:(G.oWidth=(B?D.width():D.outerWidth()))-L,marginRight:P+L}).after('<span class="ui-spinner ui-widget"></span>').next(),btnContainer=G.btnContainer=g('<div class="ui-spinner-buttons"><div class="ui-spinner-up ui-spinner-button ui-state-default ui-corner-tr"><span class="ui-icon '+x.upIconClass+'">&nbsp;</span></div><div class="ui-spinner-down ui-spinner-button ui-state-default ui-corner-br"><span class="ui-icon '+x.downIconClass+'">&nbsp;</span></div></div>')}var w,u,O,T,E,A,F,N,I,M,z=D[0].dir=="rtl";if(v&&typeof(wrapper)!="undefined"){wrapper.addClass(v)}if(y!="never"){wrapper.append(btnContainer.css({height:H,left:-L-P,top:(D.offset().top-wrapper.offset().top)+"px"}));O=G.buttons=btnContainer.find("div.ui-spinner-button");O.css({width:L-(B?O.outerWidth()-O.width():0),height:H/2-(B?O.outerHeight()-O.height():0)});w=O[0];u=O[1];T=O.find("span.ui-icon");T.css({marginLeft:(O.innerWidth()-T.width())/2,marginTop:(O.innerHeight()-T.height())/2});btnContainer.width(O.outerWidth());if(y!="always"){btnContainer.css("opacity",0)}}if(y=="hover"||y=="both"){O.add(D).bind("mouseenter"+o,function(){R(function(){F=true;if(!G.focused||(y=="hover")){G.showButtons()}})}).bind("mouseleave"+o,function J(){R(function(){F=false;if(!G.focused||(y=="hover")){G.hideButtons()}})})}if(O!=null){O.hover(function(){G.buttons.removeClass(s);if(!x.disabled){g(this).addClass(s)}},function(){g(this).removeClass(s)}).mousedown(S).mouseup(Q).mouseout(Q)}if(l&&O!=null){O.dblclick(function(){if(!x.disabled){G._change();G._doSpin((this===w?1:-1)*x.step)}return false}).bind("selectstart",function(){return false})}D.bind("keydown"+o,function(Y){var V,W,U,X=Y.keyCode;if(Y.ctrl||Y.alt){return true}if(t(X)){I=true}if(N){return false}switch(X){case m:case j:V=1;W=X==j;break;case n:case p:V=-1;W=X==p;break;case r:case f:V=(X==r)^z?1:-1;break;case q:U=G.options.min;if(U!=null){G._setValue(U)}return false;case d:U=G.options.max;U=G.options.max;if(U!=null){G._setValue(U)}return false}if(V){if(!N&&!x.disabled){keyDir=V;if(O!=null){g(V>0?w:u).addClass(i)}N=true;G._startSpin(V,W)}return false}}).bind("keyup"+o,function(V){if(V.ctrl||V.alt){return true}var U=V.keyCode;if(t(U)){I=false}switch(U){case m:case r:case j:case n:case f:case p:if(O!=null){O.removeClass(i)}G._stopSpin();N=false;return false}}).bind("keypress"+o,function(U){if(K(U.keyCode,U.charCode,U.target)){return false}}).bind("change"+o,function(){G._change()}).bind("focus"+o,function(){function U(){G.element.select()}l?U():setTimeout(U,0);G.focused=true;b=G;if(!F&&(y=="focus"||y=="both")){G.showButtons()}}).bind("blur"+o,function(){G.focused=false;if(!F&&(y=="focus"||y=="both")){G.hideButtons()}});function t(V){for(var U=0;U<a.length;U++){if(a[U]==V){return true}}return false}function K(Y,U,X){if(I){return false}var W=String.fromCharCode(U||Y),V=G.options;if((W>="0")&&(W<="9")||(W=="-")){return false}if(((G.places>0||G.places=="free")&&(W==V.point)&&(g(X).val()==null||g(X).val().indexOf(V.point)==-1))||(W==V.group)){return false}return true}function R(V){if(E){if(V===A){return}clearTimeout(E)}A=V;E=setTimeout(U,100);function U(){E=0;V()}}function S(){if(!x.disabled){var U=G.element[0],V=(this===w?1:-1);U.focus();U.select();g(this).addClass(i);M=true;G._startSpin(V)}return false}function Q(){if(M){g(this).removeClass(i);G._stopSpin();M=false}return false}},_procOptions:function(A){var B=this,y=B.element,C=B.options,w=C.min,x=C.max,v=C.step,t=C.places,u=-1,z;if(C.increment=="slow"){C.increment=[{count:1,mult:1,delay:250},{count:3,mult:1,delay:100},{count:0,mult:1,delay:50}]}else{if(C.increment=="fast"){C.increment=[{count:1,mult:1,delay:250},{count:19,mult:1,delay:100},{count:80,mult:1,delay:20},{count:100,mult:10,delay:20},{count:0,mult:100,delay:20}]}}if((w==null)&&((z=y.attr("min"))!=null)){w=parseFloat(z)}if((x==null)&&((z=y.attr("max"))!=null)){x=parseFloat(z)}if(!v&&((z=y.attr("step"))!=null)){if(z!="any"){v=parseFloat(z);C.largeStep*=v}}C.step=v=v||C.defaultStep;if((t==null)&&((z=v+"").indexOf(".")!=-1)){t=z.length-z.indexOf(".")-1}B.places=t;if((x!=null)&&(w!=null)){if(w>x){w=x}u=Math.max(Math.max(u,C.format(x,t,y).length),C.format(w,t,y).length)}if(A){B.inputMaxLength=y[0].maxLength}z=B.inputMaxLength;if(z>0){u=u>0?Math.min(z,u):z;z=Math.pow(10,u)-1;if(((x==null)||(x>z))&&z!="Infinity"){x=z}z=-(z+1)/10+1;if(((w==null)||(w<z))&&z!="-Infinity"){w=z}}if(u>0){y.attr("maxlength",u)}C.min=w;C.max=x;B._change();y.unbind(c+o);if(C.mouseWheel){y.bind(c+o,B._mouseWheel)}},_mouseWheel:function(u){var t=g.data(this,"spinner");if(!t.options.disabled&&t.focused&&(b===t)){t._change();t._doSpin(((u.wheelDelta||-u.detail)>0?1:-1)*t.options.step);return false}},_setTimer:function(v,u,x){var t=this;t._stopSpin();t.timer=setInterval(w,v);function w(){t._spin(u,x)}},_stopSpin:function(){if(this.timer){clearInterval(this.timer);this.timer=0}},_startSpin:function(w,x){var u=this,v=u.options,t=v.increment;u._change();u._doSpin(w*(x?u.options.largeStep:u.options.step));if(t&&t.length>0){u.counter=0;u.incCounter=0;u._setTimer(t[0].delay,w,x)}},_spin:function(v,w){var u=this,t=u.options.increment,x=t[u.incCounter];u._doSpin(v*x.mult*(w?u.options.largeStep:u.options.step));u.counter++;if((u.counter>x.count)&&(u.incCounter<t.length-1)){u.counter=0;x=t[++u.incCounter];u._setTimer(x.delay,v,w)}},_doSpin:function(t){var D=this,A=D.curvalue;if(A==null){A=(t>0?D.options.min:D.options.max)||0}if(D.options.places=="free"){var B=D.options.point,E=A+t,C=E.toString(),z=A.toString(),x=t.toString(),w=(z.indexOf(B)==-1?0:z.length-z.indexOf(B)-1),u=(x.indexOf(B)==-1?0:x.length-x.indexOf(B)-1),y=Math.max(w,u),v=(C.indexOf(B)==-1?0:C.length-C.indexOf(B)-1);if(v>y){D._setValue(E.toFixed(y))}else{D._setValue(E)}}else{D._setValue(A+t)}},_parseValue:function(){var t=this.element.val();return t?this.options.parse(t,this.element):null},_validate:function(w){var u=this.options,v=u.min,t=u.max;if((w==null)&&!u.allowNull){w=this.curvalue!=null?this.curvalue:v||t||0}if((t!=null)&&(w>t)){return t}else{if((v!=null)&&(w<v)){return v}else{return w}}},_change:function(){var u=this,w=u._parseValue(),v=u.options.min,t=u.options.max;if(!u.selfChange){if(isNaN(w)){w=u.curvalue}u._setValue(w,true)}},_setOption:function(t,u){g.Widget.prototype._setOption.call(this,t,u);this._procOptions()},increment:function(){this._doSpin(this.options.step)},decrement:function(){this._doSpin(-this.options.step)},showButtons:function(u){var t=this.btnContainer.stop();if(u){t.css("opacity",1)}else{t.fadeTo("fast",1)}},hideButtons:function(u){var t=this.btnContainer.stop();if(u){t.css("opacity",0)}else{t.fadeTo("fast",0)}this.buttons.removeClass(s)},_setValue:function(v,t){var u=this;u.curvalue=v=u._validate(v);u.element.val(v!=null?u.options.format(v,u.places,u.element):"");if(!t){u.selfChange=true;u.element.change();u.selfChange=false}},value:function(t){if(arguments.length){this._setValue(t);return this.element}return this.curvalue},enable:function(){this.buttons.removeClass(e);this.element[0].disabled=false;g.Widget.prototype.enable.call(this)},disable:function(){this.buttons.addClass(e).removeClass(s);this.element[0].disabled=true;g.Widget.prototype.disable.call(this)},destroy:function(t){if(typeof(this.wrapper)!="undefined"){this.wrapper.remove()}this.element.unbind(o).css({width:this.oWidth,marginRight:this.oMargin});g.Widget.prototype.destroy.call(this)}})})(jQuery);