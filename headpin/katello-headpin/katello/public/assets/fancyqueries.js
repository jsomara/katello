(function(a){a.fn.fancyQueries=function(){a(document).click(function(b){if(!(a(b.target).closest(".search").length||a(b.target).hasClass("queryeditor")||a(b.target).hasClass("showmore"))){a(".qdropdown").hide();a(".queries").removeClass("open queryeditor")}});a("#search").click(function(b){a(document).click()});this.each(function(){var g=a(".qdropdown",this);var c=this;var d=a(c).attr("data-url");var f;var h=a(this).offset();var b=a(this).outerHeight();var e=a(this).outerWidth();if(!g.length){g=a("<div class='qdropdown'></div>");g.appendTo(this).hide()}f=a('<div class="queries"><span class="arrow"></span></div>"');f.attr("data-url",d);f.appendTo(a(this));a("input",this).css("margin-left","24px");a("input",this).css("width",function(){e=a(this).width()-24;return e});f.click(function(){if(g.filter(":visible").length>0){g.hide();a(".queries").removeClass("open queryeditor")}else{a(".qdropdown").hide();a(".queries").removeClass("open queryeditor");a.get(d,function(k){var i,j,l;g.html(k).css("top",b-1);if(g.width()+h.left>a("#maincontent").width()){g.removeClass("left-menu").addClass("right-menu")}else{g.removeClass("right-menu").addClass("left-menu")}g.show(200);a(".one-line-ellipsis").ellipsis();f.addClass("open");i=a("ul:first",g);a("li.item:gt(9)",i).hide();j=a("li.item:hidden",i).length;if(j){l=a('<a class="showmore">Show '+j+" more</a>");a("#search_list").append(l);l.click(function(m){m.preventDefault();a("li.item",i).show();a(this).remove()})}})}});a(".queryeditor",g[0]).live("click",function(j){var i="<h1>Query Editor</h1>";i+="<div><h2>FIXME</h2>";i+="<p style='width: 400px; min-height: 100px;'>Initially I think this would provide help on how to compose a query. Once we have a better idea on what the queries look like, a gui editor.</p><a href='#' onclick='$(document).click()'>Close</a></div>";f.removeClass("open").addClass("queryeditor");g.empty().hide().addClass("queryeditor").html(i);if(g.width()+h.left>a("#maincontent").width()){g.removeClass("left-menu").addClass("right-menu")}else{g.removeClass("right-menu").addClass("left-menu")}g.show(200)})})}})(jQuery);$(document).ready(function(){$("#search_favorite_save").live("click",favorite.save);$("#search_favorite_destroy").live("click",favorite.destroy);$("#search_clear").live("click",favorite.clear);$(".search_query").live("click",function(){$("#search").val($(this).html());$("#search_form").submit();$(".qdropdown").hide()})});var favorite=(function(){return{success:function(a){$(".qdropdown").html(a);$(".one-line-ellipsis").ellipsis()},error:function(a){},save:function(c){c.preventDefault();var b=$("input[id^=search]").attr("value");var a=$(this).attr("data-url");$.ajax({type:"POST",url:a,data:{favorite:b},cache:false,success:favorite.success,error:favorite.error})},destroy:function(b){var c=$(this).attr("data-id");var a=$(this).attr("data-url");client_common.destroy(a,favorite.success,favorite.error)},clear:function(a){var c=$("#search_form"),b=c.find("#search");b.val("");b.change();$(".qdropdown").hide()}}})();KT.search=(function(b){var a=function(g){var d=g.url,f=g.data,c=false,e;if(d){e=function(i,h){if(!c){c=true;b.getJSON(d,{search:i.term},function(j){c=false;h(j)}).error(function(){c=false})}}}else{e=f}b.widget("custom.catcomplete",b.ui.autocomplete,{_renderMenu:function(k,j){var i=this,h="";b.each(j,function(l,m){if(m.category!=undefined&&m.category!=h){k.append("<li class='ui-autocomplete-category'>"+m.category+"</li>");h=m.category}if(m.error!=undefined){k.append("<li class='ui-autocomplete-error'>"+m.error+"</li>")}if(m.completed!=undefined){b("<li></li>").data("item.autocomplete",m).append("<a><strong class='ui-autocomplete-completed'>"+m.completed+"</strong>"+m.part+"</a>").appendTo(k)}else{i._renderItem(k,m)}})}});b(document).ready(function(){b("#search").catcomplete({source:e,minLength:0,delay:200,search:function(h,i){b(".auto_complete_clear").hide()},open:function(h,i){b(".auto_complete_clear").show()}});b("#search").live("focus",function(h){if(b(this)[0].value==""){b(this).catcomplete("search")}})})};return{enableAutoComplete:a}})(jQuery);