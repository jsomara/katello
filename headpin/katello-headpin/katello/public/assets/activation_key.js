KT.panel.list.registerPage("activation_keys",{create:"new_activation_key"});$(document).ready(function(){KT.panel.set_expand_cb(function(){KT.activation_key.initialize_edit()});$("#save_key").live("submit",function(a){a.preventDefault();KT.activation_key.save_key($(this))});$("#cancel_key").live("click",function(a){a.preventDefault();KT.activation_key.cancel_key($(this))});env_select.click_callback=function(a){KT.activation_key.save_selected_environment(a);KT.activation_key.get_system_templates();KT.activation_key.get_products()};$("#activation_key_system_template_id").live("change",function(){KT.activation_key.highlight_system_templates(false)});$("#go_to_available_subscriptions").live("click",function(a){a.preventDefault();KT.activation_key.go_to_available_subscriptions()});$(".clickable.product_family").live("click",function(){KT.activation_key.toggle_family($(this))});$(".family_checkbox").live("click",function(){KT.activation_key.toggle_family_checkboxes($(this),this.checked)});$('#subscription_form input[type="checkbox"]').live("click",function(){KT.activation_key.toggle_parent_checkbox($(this))});$("input[id^=filter]").live("change, keyup",function(){if($.trim($(this).val()).length==0){var a=$("tr[data-family_begin]");a.each(function(){var c=$(this).find("a img");if(c.attr("src").indexOf("collapsed")!==-1){var b=$(this).attr("data-family_begin");$('tr[data-in_family="'+b+'"]').slideToggle()}})}})});KT.activation_key=(function(h){var m=function(){var r=h("#subscription_submit_button");var q=h("#fake_subscription_submit_button");var t=h('#subscription_form input[type="checkbox"]');var s=0;r.hide();t.each(function(){h(this).change(function(){if(h(this).is(":checked")){s++;if(!(r.is(":visible"))){q.fadeOut("fast",function(){r.fadeIn()})}}else{s--;if((r.is(":visible"))&&s==0){r.fadeOut("fast",function(){q.fadeIn()})}}})});r.unbind("click").click(disableSubmit)},p=function(){var q=h("#go_to_available_subscriptions").attr("href");h.ajax({cache:"false",type:"GET",url:q,dataType:"html",success:function(r){h(".panel-content").html(r);KT.panel.panelResize(h("#panel_main"),false)}})},o=function(){k();f();n(false)},k=function(){h("#path-expanded").hide();env_select.reset_hover();env_select.recalc_scroll()},j=function(q){a();q.ajaxSubmit({success:function(r){n(false);f()},error:function(r){n(false);f()}})},d=function(r){var q=h("#cancel_key").attr("data-url");if(q!==undefined){a();h.ajax({type:"GET",url:q,cache:false,success:function(s){h(".panel-content").html(s);o()},error:function(s){o()}})}},g=function(s){var q=s.closest("tr").attr("data-family_begin");h('tr[data-in_family="'+q+'"]').slideToggle();var r=s.find("img");if(r.attr("src").indexOf("collapsed")===-1){r.attr("src","images/icons/expander-collapsed.png")}else{r.attr("src","images/icons/expander-expanded.png")}},c=function(s,r){var q=s.closest("tr"),t=q.attr("data-family_begin");q.siblings('tr[data-in_family="'+t+'"]').find("input:checkbox").attr("checked",r)},l=function(x){var u=x.closest("tr"),w=u.attr("data-in_family");if(w!==undefined){var t=u.prevAll('tr[data-family_begin="'+w+'"]');if(t!==undefined){var q=t.find("input:checkbox"),s=t.siblings('tr[data-in_family="'+w+'"]').find("input:checkbox"),v=s.length,r=0;s.each(function(){if(this.checked){r++}});if(v==r){q.attr("checked",true)}else{if(r>0){q.attr("checked",false)}else{q.attr("checked",false)}}}}},b=function(){var q=h(".path_link.active").attr("data-templates_url");a();h.ajax({type:"GET",url:q,cache:false,success:function(r){var s="";s+='<option value="">'+i18n.noTemplate+"</option>";for(var t=0;t<r.length;t++){s+='<option value="'+r[t].id+'">'+r[t].name+"</option>"}h("#activation_key_system_template_id").html(s);if(r.length>0){n(true)}f()},error:function(r){f()}})},e=function(){var q=h(".path_link.active").attr("data-products_url");if(q!==undefined){a();h.ajax({type:"GET",url:q,cache:false,success:function(r){h(".productsbox").html(r);f()},error:function(r){f()}})}},i=function(q){h("#activation_key_environment_id").attr("value",q)},a=function(){h("#cancel_key").attr("disabled","disabled");h("input[id^=save_key]").attr("disabled","disabled")},f=function(){h("#cancel_key").removeAttr("disabled");h("input[id^=save_key]").removeAttr("disabled")},n=function(q){var r=h("#activation_key_system_template_id");if(q){if(!r.next("span").hasClass("highlight_input_text")){r.addClass("highlight_input");r.after('<span class ="highlight_input_text">'+i18n.update_template+"</span>")}}else{r.removeClass("highlight_input");h(".highlight_input_text").remove()}};return{subscription_setup:m,go_to_available_subscriptions:p,initialize_edit:o,reset_env_select:k,save_key:j,cancel_key:d,toggle_family:g,toggle_family_checkboxes:c,toggle_parent_checkbox:l,get_system_templates:b,get_products:e,save_selected_environment:i,disable_buttons:a,enable_buttons:f,highlight_system_templates:n}}(jQuery));