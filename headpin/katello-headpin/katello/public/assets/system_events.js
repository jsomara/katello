KT.events=function(){var f=$(".events").attr("data-system_id"),e=0,k=0,a=undefined,l=$("#loaded_summary"),d=$("#more"),g=0,b=function(){var n=$(".events"),o=$("#list-spinner"),m=d.data("scroll_url")+"?offset="+k+"&";o.fadeIn();$.ajax({type:"GET",url:m,cache:false,success:function(p){o.fadeOut();n.append(p);$("#filter").keyup();$(".scroll-pane").jScrollPane().data("jsp").reinitialise();j();if(k===e){d.empty().remove()}},error:function(){o.fadeOut()}})},i=function(m){$.each(m,function(o,n){var p=undefined,q=undefined;if(!n["pending?"]){p=$(".event_name[data-pending-task-id="+n.id+"]");if(p!==undefined){p.parent().html(n.status_html)}}});if($(".event_name[data-pending-task-id]").length===0){a.stop()}},c=function(){var m=8000,n=[];$(".event_name[data-pending-task-id]").each(function(o){n[o]=$(this).data("pending-task-id")});if(n.length>0){a=$.PeriodicalUpdater(KT.routes.status_system_events_path(f),{method:"get",type:"json",data:function(){return{id:n}},global:false,minTimeout:m,maxTimeout:m},i)}},h=function(){e=$(".events").data("total_events");if(e!==undefined){e=parseInt(e,10)}else{e=0}if(e>0){if(d!==undefined){g=parseInt(d.data("page_size"),10);d.bind("click",b)}else{g=0}j();if($(".event_name[data-pending-task-id]").length>0){c()}var m=$("#event_filter_button"),n=$("#event_search_filter"),o=$("#list-spinner");m.bind("click",function(p){p.preventDefault();$.ajax({type:"GET",url:n.data("search_url"),data:{search:n.val()},cache:false,success:function(q){o.fadeOut();$("#event_items").html(q.html);$("#filter").keyup();$(".scroll-pane").jScrollPane().data("jsp").reinitialise();j();if(k===e){d.empty().remove()}},error:function(){o.fadeOut()}})})}},j=function(){var m=g;k=$("tr.tasks").length;l.html(i18n.x_of_y_events(k,e));if(m>(e-k)){m=e-k}d.text(i18n.x_more_events(m))};return{initEvents:h}}();$(document).ready(function(){KT.events.initEvents()});