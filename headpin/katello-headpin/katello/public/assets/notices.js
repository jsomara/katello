var notices=(function(){return{setup_notices:function(a){if(a===undefined){a=45000}notices.checkTimeout=a;notices.start()},clearPreviousFailures:function(a){$("."+a).closest(".jnotify-notification").remove()},displayNotice:function(g,e,b){var f=$.parseJSON(e),c={type:g,slideSpeed:200,alwaysClosable:true},d=function(l){var k="<ul class="+b+">",h,j=l.length;for(h=0;h<j;h+=1){k+="<li>"+l[h]+"</li>"}k+="</ul>";return k};if(g==="success"){notices.clearPreviousFailures(b)}if((g==="error")||(g==="warning")){c.sticky=true;c.fadeSpeed=600}else{if(g==="message"){c.sticky=true;c.fadeSpeed=600}else{c.sticky=false;c.fadeSpeed=600}}if(f.validation_errors!==undefined){var a=d(f.validation_errors);a="<span>"+i18n.validation_errors+"</span>"+a;$.jnotify(a,c);$(".jnotify-message ul").css({"list-style":"disc","margin-left":"30px"})}if(f.notices.length!==0){$.jnotify(d(f.notices),c)}},addNotices:function(a){if(!a||a.new_notices.length===0){return true}if(a.unread_count){$("#unread_notices").text(a.unread_count)}$.each(a.new_notices,function(b,c){notices.displayNotice(c.level,window.JSON.stringify({notices:[c.text]}),c.request_type)});return true},checkNotices:function(){var a=$("#get_notices_url").attr("data-url");$.ajax({type:"GET",url:a,dataType:"json",global:false,success:notices.addNotices})},checkNoticesInResponse:function(c){var b,a;if(c!==undefined){b=c.getResponseHeader("X-Message");if(b){a=c.getResponseHeader("X-Message-Type");messageRequestType=c.getResponseHeader("X-Message-Request-Type");notices.displayNotice(a,KT.common.decode(b),messageRequestType)}}},start:function(){var a=$("#get_notices_url").attr("data-url");var b=$.PeriodicalUpdater(a,{method:"get",type:"json",global:false,minTimeout:notices.checkTimeout,maxTimeout:notices.checkTimeout},notices.addNotices)}}})();$(document).ready(function(){$(document).ajaxComplete(function(b,c,a){notices.checkNoticesInResponse(c)})});(function(b){var a=function(d){try{}catch(c){}};b.PeriodicalUpdater=function(d,c,e,h){var r=jQuery.extend(true,{url:d,cache:false,method:"GET",data:"",minTimeout:1000,maxTimeout:8000,multiplier:2,maxCalls:0,autoStop:0},c);var i=null;var m=r.minTimeout;var q=r.maxCalls;var k=r.autoStop;var l=0;var n=0;var o=q;var j=function(v){if(i!=null){clearTimeout(i)}m=v;a("resetting timer to "+m+".");i=setTimeout(f,m)};var t=function(){if(r.multiplier>=1){before=m;m=m*r.multiplier;if(m>r.maxTimeout){m=r.maxTimeout}after=m;a("adjusting timer from "+before+" to "+after+".");j(m)}};var g=jQuery.extend(true,{},r);if(r.type&&!g.dataType){g.dataType=r.type}if(r.sendData){g.data=r.sendData}g.type=r.method;g.ifModified=true;var s={restart:function(){q=o;l=0;j(m);return},stop:function(){q=-1;return}};function f(){var v=jQuery.extend(true,{},g);if(typeof(c.data)=="function"){v.data=c.data();if(v.data){if(typeof(v.data)=="number"){v.data=v.data.toString()}}}if(q==0){b.ajax(v)}else{if(q>0&&l<q){b.ajax(v);l++}}}var p=null;var u=null;g.success=function(v){a("Successful run! (In 'success')");p=v};g.complete=function(w,v){if(q==-1){return}if(v=="success"||v=="notmodified"){var x=b.trim(w.responseText);if(x=="STOP_AJAX_CALLS"){s.stop();return}if(u==x){if(k>0){n++;if(n==k){s.stop();if(h){h(n)}return}}t()}else{n=0;j(r.minTimeout);u=x;if(p==null){p=x}if((g.dataType==="json")&&(typeof(p)==="string")&&(v=="success")){p=JSON.parse(p)}if(r.success){r.success(p,v,w,s)}if(e){e(p,v,w,s)}}}p=null};g.error=function(v,w){if(w!="notmodified"){u=null;j(r.minTimeout)}if(r.error){r.error(v,w)}};b(function(){j(m)});return s}})(jQuery);