KT.user_page=function(){var d=function(){var j=$(this);var i=j.attr("data-url");j.addClass("disabled");$.ajax({type:"POST",url:i,data:{},cache:false,success:function(k){j.button("destroy");j.text(k)},error:function(k){j.removeClass("disabled");j.button("option","label",k)}})},b=function(){var l=$(this);var k=$(this).attr("name");var j={};if(l.attr("checked")!==undefined){j[k]="1"}else{j[k]="0"}var i=l.attr("data-url");$.ajax({type:"PUT",url:i,data:j,cache:false});return false},c=function(){var k=$(".verify_password");var j=$("#password_field").val();var i=$("#confirm_field").val();if(j!=i){$("#password_conflict").text(i18n.password_match);$(k).addClass("disabled");$("#save_password").die("click");$("#save_user").addClass("disabled");return false}else{if($("#no_env_box").length==0){$("#password_conflict").text("");$(k).removeClass("disabled");$("#save_password").die("click");$("#save_password").live("click",e);$("#save_user").removeClass("disabled");return true}else{return false}}},a=function(){var l=$(this);if(l.hasClass("disabled")){return false}if(c()){l.addClass("disabled");var m=$("#username_field").val();var k=$("#password_field").val();var j=$("#email_field").val();var i=$(".path_link.active").attr("data-env_id");$.ajax({type:"POST",url:l.attr("data-url"),data:{user:{username:m,password:k,email:j,env_id:i}},cache:false,success:function(n){l.removeClass("disabled");KT.panel.list.add(n);KT.panel.closePanel($("#panel"))},error:function(){l.removeClass("disabled")}})}},e=function(){var k=$(this);var j=k.attr("data-url");var i=$("#password_field").val();k.addClass("disabled");$.ajax({type:"PUT",url:j,data:{user:{password:i}},cache:false,success:function(){k.removeClass("disabled")},error:function(l){k.removeClass("disabled")}})},f=function(){var l=$(this);var k=l.attr("data-url");var j=$("#password_field").val();var i=$(".path_link.active").attr("data-env_id");l.addClass("disabled");$.ajax({type:"PUT",url:k,data:{env_id:{env_id:i}},cache:false,success:function(m){$("#env_name").html(m.env);$("#org_name").html(m.org);env_select.original_env_id=i;env_select.env_changed_callback(i)},error:function(m){l.removeClass("disabled")}})},h=function(j){j.preventDefault();var i=$(this).find('input[type|="submit"]');i.attr("disabled","disabled");$(this).ajaxSubmit({success:function(k){i.removeAttr("disabled")},error:function(k){i.removeAttr("disabled")}})},g=function(){$("#password_field").live("keyup.katello",c);$("#confirm_field").live("keyup.katello",c);$("#clear_helptips").live("click",d);$("#save_password").live("click",e);$("#update_user").live("click",f);$("#update_roles").live("submit",h)};return{createNewUser:a,verifyPassword:c,updateUser:f,changePassword:e,checkboxChanged:b,clearHelptips:d,updateRoles:h,registerEdits:g}}();KT.panel.list.registerPage("users",{create:"new_user",validation:KT.user_page.verifyPassword,extra_create_data:function(){var a=$(".path_link.active").attr("data-env_id");return{user:{env_id:a}}}});$(document).ready(function(){KT.user_page.registerEdits();env_select.ajax_params={};env_select.original_env_id=undefined;env_select.env_changed_callback=function(a){if(env_select.original_env_id==a){$("#update_user").addClass("disabled")}else{$("#update_user").removeClass("disabled")}};ratings=[{minScore:0,className:"meterFail",text:i18n.very_weak},{minScore:25,className:"meterWarn",text:i18n.weak},{minScore:50,className:"meterGood",text:i18n.good},{minScore:75,className:"meterExcel",text:i18n.strong}];KT.panel.set_expand_cb(function(){$(".multiselect").multiselect({dividerLocation:0.5,sortable:false});var b=$("#org_id_org_id");b.change(function(d){var e=$("#env_box");var f=b.val();if(!f){e.html(i18n.noDefaultEnv);env_select.env_changed_callback("")}else{var c=KT.routes.environments_partial_organization_path(f),g={};if(env_select.ajax_params!==undefined){g=env_select.ajax_params}$.ajax({type:"GET",url:c,data:g,success:function(h){e.html(h);env_select.env_changed_callback(env_select.get_selected_env())}})}});var a=$("#locale_locale");a.change(function(c){$("#locale_form").trigger("submit")});$("#helptips_enabled").bind("change",KT.user_page.checkboxChanged)})});